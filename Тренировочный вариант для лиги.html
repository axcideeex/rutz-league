<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rutz | –ö–ª—É–±–Ω–∞—è –ª–∏–≥–∞</title>
  <style>
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      height: 100vh;
      margin: 0;
      font-family: sans-serif;
      background: #111;
      color: #fff;
    }
    .game-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 10px;
    }
    .game-board {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
    }
    .left, .right {
      width: 150px;
      margin: 10px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(4, 60px);
      grid-template-rows: repeat(4, 60px);
      gap: 5px;
      background: #222;
      padding: 10px;
      border-radius: 10px;
    }
    .cell {
      width: 60px;
      height: 60px;
      background: #555;
      border-radius: 5px;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      position: relative;
      font-size: 20px;
      transition: background 0.2s ease; /* –ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –¥–ª—è —Ñ–æ–Ω–∞ */
    }
    .cell.revealed {
      background: #333;
      cursor: default;
    }
    /* –°—Ç–∏–ª—å –¥–ª—è —è—á–µ–π–∫–∏, –ø–æ –∫–æ—Ç–æ—Ä–æ–π –ø–æ–ª—É—á–µ–Ω–∞ –æ–±—ã—á–Ω–∞—è –ø–æ–¥—Å–∫–∞–∑–∫–∞ */
    .cell.hinted {
      border: 1px dashed #888; /* –õ–µ–≥–∫–∏–π –≤–∏–∑—É–∞–ª—å–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä */
    }
    /* –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –ø–æ–¥—Å–∫–∞–∑–∞–Ω–Ω–æ–π —è—á–µ–π–∫–∏ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
    .cell.hinted:hover::after {
      content: attr(data-hint-content);
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      background: rgba(0, 0, 0, 0.8); /* –ü–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω */
      color: #fff;
      font-size: 20px;
      border-radius: 5px;
    }

    .menu {
      position: absolute;
      top: 0;
      left: 0;
      background: #000;
      padding: 5px;
      border: 1px solid #fff;
      z-index: 10;
      border-radius: 5px;
    }
    .menu button {
      display: block;
      width: 80px;
      margin: 2px 0;
      padding: 5px;
      background: #444;
      color: #fff;
      border: none;
      border-radius: 3px;
      cursor: pointer;
      transition: background 0.2s ease;
    }
    .menu button:hover:not(:disabled) {
      background: #666;
    }
    .menu button:disabled {
      background: #222;
      color: #888;
      cursor: not-allowed;
    }

    #result {
      margin-top: 10px;
      font-size: 18px;
      color: yellow;
      text-align: center;
    }
    .game-buttons {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }
    .game-buttons button {
      padding: 10px 20px;
      font-size: 18px;
      background: #007bff;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.2s ease;
    }
    .game-buttons button:hover {
      background: #0056b3;
    }
    #loading-indicator {
      display: none;
      color: #fff;
      margin-top: 10px;
    }
    @media (max-width: 600px) {
      .grid {
        grid-template-columns: repeat(4, 50px);
        grid-template-rows: repeat(4, 50px);
        gap: 4px;
      }
      .cell {
        width: 50px;
        height: 50px;
        font-size: 16px;
      }
      .left, .right {
        width: auto;
        text-align: center;
      }
    }
  </style>
</head>
<body>
<div class="game-container">
  <div class="game-board">
    <div class="left">
      <h3>–ù–∞–π–¥–µ–Ω–æ:</h3>
      <div id="found">üîµ0/2 üî¥0/2 üü°0/1 üí£0/5</div>
    </div>
    <div class="grid" id="grid"></div>
    <div class="right">
      <h3>–≠–Ω–µ—Ä–≥–∏—è</h3>
      <div id="energy">100</div>
    </div>
  </div>
  <div id="result"></div>
  <div id="loading-indicator">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
  <div class="game-buttons">
    <button id="restart" style="display:none" onclick="restartGame()">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
    </div>
</div>

<script>
const grid = document.getElementById('grid');
const energyEl = document.getElementById('energy');
const foundEl = document.getElementById('found');
const resultEl = document.getElementById('result');
const restartBtn = document.getElementById('restart');
const loadingIndicator = document.getElementById('loading-indicator');

// –°—Ç–æ–∏–º–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–π –∏ —à—Ç—Ä–∞—Ñ—ã
const energyCost = { hint: 5, open: 6, bombPenalty: 20 };
let energy = 100;

let CONTENT = []; // –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è (—Å–µ–π—Ñ—ã, –±–æ–º–±—ã, –∫–ª—é—á–∏)
let found = { blue: 0, red: 0, yellow: 0, bomb: 0 }; // –ù–∞–π–¥–µ–Ω–Ω—ã–µ –∫–ª—é—á–∏ –∏ –±–æ–º–±—ã
let gameOutcome = ''; // 'win' –∏–ª–∏ 'lose'

/**
 * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ —Å —Å–µ–π—Ñ–∞–º–∏, –±–æ–º–±–∞–º–∏ –∏ –∫–ª—é—á–∞–º–∏.
 * –ü—ã—Ç–∞–µ—Ç—Å—è —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–µ –¥–æ 1000 —Ä–∞–∑, —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ.
 * –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç true, –µ—Å–ª–∏ –ø–æ–ª–µ —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ, –∏–Ω–∞—á–µ false.
 */
function generateGrid() {
  // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–∏–ø–æ–≤ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞ –ø–æ–ª–µ
  const safeColors = [
    { type: 'key', color: 'blue', count: 2 },
    { type: 'key', color: 'red', count: 2 },
    { type: 'key', color: 'yellow', count: 1 },
    { type: 'bomb', color: 'blue', count: 2 },
    { type: 'bomb', color: 'red', count: 2 },
    { type: 'bomb', color: 'yellow', count: 1 }
  ];

  for (let attempt = 0; attempt < 1000; attempt++) {
    const tempBoard = Array(16).fill(null); // –í—Ä–µ–º–µ–Ω–Ω–æ–µ –ø–æ–ª–µ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
    const occupied = new Set(); // –ó–∞–Ω—è—Ç—ã–µ –∏–Ω–¥–µ–∫—Å—ã —è—á–µ–µ–∫
    let ok = true; // –§–ª–∞–≥ —É—Å–ø–µ—à–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

    // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º —Ç–∏–ø—ã —Å–µ–π—Ñ–æ–≤ –¥–ª—è –ª—É—á—à–µ–π —Å–ª—É—á–∞–π–Ω–æ—Å—Ç–∏ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è
    const shuffledSafeColors = [...safeColors].sort(() => Math.random() - 0.5);

    for (const item of shuffledSafeColors) {
      let placedCount = 0; // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–∑–º–µ—â–µ–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Ç–µ–∫—É—â–µ–≥–æ —Ç–∏–ø–∞
      // –°–æ–∑–¥–∞–µ–º —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö (–Ω–µ–∑–∞–Ω—è—Ç—ã—Ö) –∏–Ω–¥–µ–∫—Å–æ–≤ –∏ –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –µ–≥–æ
      const availableIndices = Array.from({ length: 16 }, (_, i) => i).filter(i => !occupied.has(i));
      availableIndices.sort(() => Math.random() - 0.5);

      for (const index of availableIndices) {
        if (placedCount === item.count) break; // –ï—Å–ª–∏ —Ä–∞–∑–º–µ—Å—Ç–∏–ª–∏ –Ω—É–∂–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, –≤—ã—Ö–æ–¥–∏–º

        const neighbors = getNeighbors(index); // –ü–æ–ª—É—á–∞–µ–º —Å–æ—Å–µ–¥–µ–π —Ç–µ–∫—É—â–µ–π —è—á–µ–π–∫–∏
        const conflict = neighbors.some(n => {
          const neighbor = tempBoard[n];
          if (!neighbor) return false; // –ï—Å–ª–∏ —Å–æ—Å–µ–¥ –ø—É—Å—Ç, –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ –Ω–µ—Ç
          // –ö–æ–Ω—Ñ–ª–∏–∫—Ç, –µ—Å–ª–∏ —Å–æ—Å–µ–¥ —Ç–æ–≥–æ –∂–µ —Ç–∏–ø–∞ –∏ —Ü–≤–µ—Ç–∞
          if (neighbor.type === item.type && neighbor.color === item.color) return true;
          // –ö–æ–Ω—Ñ–ª–∏–∫—Ç, –µ—Å–ª–∏ –±–æ–º–±–∞ –∏ –∫–ª—é—á –æ–¥–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞ —è–≤–ª—è—é—Ç—Å—è —Å–æ—Å–µ–¥—è–º–∏
          if ((item.type === 'bomb' && neighbor.type === 'key' && item.color === neighbor.color) ||
              (item.type === 'key' && neighbor.type === 'bomb' && item.color === neighbor.color)) return true;
          return false;
        });

        if (conflict) continue; // –ï—Å–ª–∏ –µ—Å—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —ç—Ç—É —è—á–µ–π–∫—É

        tempBoard[index] = { type: item.type, color: item.color }; // –†–∞–∑–º–µ—â–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç
        occupied.add(index); // –û—Ç–º–µ—á–∞–µ–º —è—á–µ–π–∫—É –∫–∞–∫ –∑–∞–Ω—è—Ç—É—é
        placedCount++;
      }

      if (placedCount < item.count) {
        ok = false; // –ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Ç–µ–∫—É—â–µ–≥–æ —Ç–∏–ø–∞
        break;
      }
    }

    if (ok) {
      // –ï—Å–ª–∏ –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —É—Å–ø–µ—à–Ω–æ —Ä–∞–∑–º–µ—â–µ–Ω—ã, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª–µ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º true
      CONTENT = tempBoard.map(item => item || { type: 'empty' }); // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏
      return true;
    }
  }

  // –ï—Å–ª–∏ –ø–æ—Å–ª–µ 1000 –ø–æ–ø—ã—Ç–æ–∫ –Ω–µ —É–¥–∞–ª–æ—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –ø–æ–ª–µ
  resultEl.textContent = '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –ø–æ–ª–µ! –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.';
  CONTENT = []; // –û—á–∏—â–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–æ–ª—è
  return false; // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å
}

/**
 * –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω–¥–µ–∫—Å—ã —Å–æ—Å–µ–¥–Ω–∏—Ö —è—á–µ–µ–∫ –¥–ª—è –∑–∞–¥–∞–Ω–Ω–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞.
 */
function getNeighbors(index) {
  const x = index % 4; // –ö–æ–ª–æ–Ω–∫–∞
  const y = Math.floor(index / 4); // –†—è–¥
  const neighbors = [];

  for (let dx = -1; dx <= 1; dx++) {
    for (let dy = -1; dy <= 1; dy++) {
      if (dx === 0 && dy === 0) continue; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–∞–º—É —è—á–µ–π–∫—É
      const nx = x + dx, ny = y + dy; // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Å–æ—Å–µ–¥–∞
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–æ—Å–µ–¥ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ø–æ–ª—è
      if (nx >= 0 && nx < 4 && ny >= 0 && ny < 4) {
        neighbors.push(ny * 4 + nx); // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω–¥–µ–∫—Å —Å–æ—Å–µ–¥–∞
      }
    }
  }
  return neighbors;
}

/**
 * –†–µ–Ω–¥–µ—Ä–∏—Ç –∏–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ –≤ HTML.
 */
function renderGrid() {
  grid.innerHTML = ''; // –û—á–∏—â–∞–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–µ—Ç–∫–∏
  for (let i = 0; i < 16; i++) {
    const cell = document.createElement('div');
    cell.className = 'cell';
    cell.dataset.index = i;
    cell.textContent = '?'; // –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ –≤—Å–µ —è—á–µ–π–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç '?'
    cell.addEventListener('click', onCellClick); // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
    grid.appendChild(cell);
  }
}

/**
 * –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ —è—á–µ–π–∫–µ.
 * –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–µ–Ω—é –¥–µ–π—Å—Ç–≤–∏–π (–ü–æ–¥—Å–∫–∞–∑–∫–∞, –û—Ç–∫—Ä—ã—Ç—å).
 */
function onCellClick(e) {
  const index = e.currentTarget.dataset.index;
  const cell = e.currentTarget;

  // –£–¥–∞–ª—è–µ–º –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–µ–Ω—é –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –Ω–æ–≤–æ–≥–æ
  document.querySelectorAll('.menu').forEach(m => m.remove());

  // –ï—Å–ª–∏ —è—á–µ–π–∫–∞ —É–∂–µ –æ—Ç–∫—Ä—ã—Ç–∞, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
  if (cell.classList.contains('revealed')) return;

  const menu = document.createElement('div');
  menu.className = 'menu';

  const hintBtn = document.createElement('button');
  hintBtn.textContent = '–ü–æ–¥—Å–∫–∞–∑–∫–∞';
  hintBtn.onclick = (event) => { // –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä event
    event.stopPropagation(); // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–ø–ª—ã—Ç–∏–µ —Å–æ–±—ã—Ç–∏—è
    if (energy < energyCost.hint) {
      resultEl.textContent = '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏ –¥–ª—è –ø–æ–¥—Å–∫–∞–∑–∫–∏!';
      cell.querySelector('.menu')?.remove(); // –£–¥–∞–ª—è–µ–º –º–µ–Ω—é
      return;
    }
    energy -= energyCost.hint; // –í—ã—á–∏—Ç–∞–µ–º —ç–Ω–µ—Ä–≥–∏—é –∑–∞ –ø–æ–¥—Å–∫–∞–∑–∫—É
    energyEl.textContent = energy; // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏
    revealHint(index, cell); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
    cell.querySelector('.menu')?.remove(); // –£–¥–∞–ª—è–µ–º –º–µ–Ω—é
    checkGameOver(); // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ª–æ–≤–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–≥—Ä—ã
  };
  // –û—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É "–ü–æ–¥—Å–∫–∞–∑–∫–∞", –µ—Å–ª–∏ —è—á–µ–π–∫–∞ —É–∂–µ –±—ã–ª–∞ –ø–æ–¥—Å–∫–∞–∑–∞–Ω–∞ (–æ–±—ã—á–Ω–æ–π –ø–æ–¥—Å–∫–∞–∑–∫–æ–π)
  if (cell.classList.contains('hinted')) {
    hintBtn.disabled = true;
    hintBtn.textContent = '–ü–æ–¥—Å–∫–∞–∑–∞–Ω–æ';
  }
  menu.appendChild(hintBtn);

  const openBtn = document.createElement('button');
  openBtn.textContent = '–û—Ç–∫—Ä—ã—Ç—å';
  openBtn.onclick = (event) => { // –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä event
    event.stopPropagation(); // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–ø–ª—ã—Ç–∏–µ —Å–æ–±—ã—Ç–∏—è
    if (energy < energyCost.open) {
      resultEl.textContent = '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è!';
      cell.querySelector('.menu')?.remove(); // –£–¥–∞–ª—è–µ–º –º–µ–Ω—é
      return;
    }
    energy -= energyCost.open; // –í—ã—á–∏—Ç–∞–µ–º —ç–Ω–µ—Ä–≥–∏—é –∑–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ
    energyEl.textContent = energy; // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏
    revealSafe(index, cell); // –û—Ç–∫—Ä—ã–≤–∞–µ–º —Å–µ–π—Ñ
    cell.querySelector('.menu')?.remove(); // –£–¥–∞–ª—è–µ–º –º–µ–Ω—é
    checkGameOver(); // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ª–æ–≤–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–≥—Ä—ã
  };
  menu.appendChild(openBtn);

  cell.appendChild(menu); // –î–æ–±–∞–≤–ª—è–µ–º –º–µ–Ω—é –∫ —è—á–µ–π–∫–µ
}

/**
 * –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —è—á–µ–π–∫–∏ –∫–∞–∫ –ø–æ–¥—Å–∫–∞–∑–∫—É (–±–µ–∑ –æ—Ç–∫—Ä—ã—Ç–∏—è).
 */
function revealHint(index, cell) {
  const item = CONTENT[index];
  cell.classList.add('hinted'); // –û—Ç–º–µ—á–∞–µ–º —è—á–µ–π–∫—É –∫–∞–∫ –ø–æ–¥—Å–∫–∞–∑–∞–Ω–Ω—É—é
  cell.dataset.hintContent = symbol(item); // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
  // cell.textContent –æ—Å—Ç–∞–µ—Ç—Å—è '?'
}

/**
 * –û—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å–µ–π—Ñ –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã.
 */
function revealSafe(index, cell) {
  const item = CONTENT[index];
  cell.classList.add('revealed'); // –û—Ç–º–µ—á–∞–µ–º —è—á–µ–π–∫—É –∫–∞–∫ –æ—Ç–∫—Ä—ã—Ç—É—é
  cell.textContent = symbol(item); // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–∏–º–≤–æ–ª —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ

  // –ï—Å–ª–∏ —è—á–µ–π–∫–∞ –±—ã–ª–∞ –ø–æ–¥—Å–∫–∞–∑–∞–Ω–Ω–æ–π, —É–±–∏—Ä–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∫–ª–∞—Å—Å –∏ –∞—Ç—Ä–∏–±—É—Ç
  if (cell.classList.contains('hinted')) {
    cell.classList.remove('hinted');
    cell.removeAttribute('data-hint-content');
  }

  if (item.type === 'key') {
    found[item.color] = (found[item.color] || 0) + 1; // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –∫–ª—é—á–µ–π
  } else if (item.type === 'bomb') {
    found.bomb++; // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –±–æ–º–±
    energy -= energyCost.bombPenalty; // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —à—Ç—Ä–∞—Ñ —ç–Ω–µ—Ä–≥–∏–∏ –∑–∞ –±–æ–º–±—É
    energyEl.textContent = energy; // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏
  }

  // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
  foundEl.textContent = `üîµ${found.blue || 0}/2 üî¥${found.red || 0}/2 üü°${found.yellow || 0}/1 üí£${found.bomb || 0}/5`;
}

/**
 * –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–∏–º–≤–æ–ª –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —è—á–µ–π–∫–∏.
 */
function symbol(item) {
  if (item.type === 'empty') return '‚ùå'; // –ü—É—Å—Ç–∞—è —è—á–µ–π–∫–∞
  if (item.type === 'key') {
    if (item.color === 'blue') return 'üîµüîë';
    if (item.color === 'red') return 'üî¥üîë';
    if (item.color === 'yellow') return 'üü°üîë';
  }
  if (item.type === 'bomb') {
    if (item.color === 'blue') return 'üí£üîµ';
    if (item.color === 'red') return 'üí£üî¥';
    if (item.color === 'yellow') return 'üí£üü°';
  }
  return '?'; // –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø
}

/**
 * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —É—Å–ª–æ–≤–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–≥—Ä—ã (–ø–æ–±–µ–¥–∞ –∏–ª–∏ –ø–æ—Ä–∞–∂–µ–Ω–∏–µ).
 */
function checkGameOver() {
  // –£—Å–ª–æ–≤–∏–µ –ø–æ–±–µ–¥—ã: –≤—Å–µ –∫–ª—é—á–∏ –Ω–∞–π–¥–µ–Ω—ã
  if (found.blue === 2 && found.red === 2 && found.yellow === 1) {
    resultEl.textContent = 'üéâ –ü–æ–±–µ–¥–∞! –í—Å–µ –∫–ª—é—á–∏ –Ω–∞–π–¥–µ–Ω—ã!';
    gameOutcome = 'win';
    restartBtn.style.display = 'block'; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞"
    // –û—Ç–∫–ª—é—á–∞–µ–º –∫–ª–∏–∫–∏ –ø–æ –æ—Å—Ç–∞–≤—à–∏–º—Å—è —è—á–µ–π–∫–∞–º
    grid.querySelectorAll('.cell:not(.revealed)').forEach(cell => {
      cell.removeEventListener('click', onCellClick);
      cell.style.cursor = 'default';
    });
  }
  // –£—Å–ª–æ–≤–∏–µ –ø–æ—Ä–∞–∂–µ–Ω–∏—è: —ç–Ω–µ—Ä–≥–∏—è –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å
  else if (energy <= 0) { // –ò–∑–º–µ–Ω–µ–Ω–æ –Ω–∞ <= 0 –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–æ–Ω—Ü–∞ —ç–Ω–µ—Ä–≥–∏–∏
    resultEl.textContent = 'üò¢ –ü–æ—Ä–∞–∂–µ–Ω–∏–µ! –≠–Ω–µ—Ä–≥–∏—è –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å.';
    gameOutcome = 'lose';
    restartBtn.style.display = 'block'; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞"
    // –û—Ç–∫–ª—é—á–∞–µ–º –∫–ª–∏–∫–∏ –ø–æ –æ—Å—Ç–∞–≤—à–∏–º—Å—è —è—á–µ–π–∫–∞–º
    grid.querySelectorAll('.cell:not(.revealed)').forEach(cell => {
      cell.removeEventListener('click', onCellClick);
      cell.style.cursor = 'default';
    });
  }
}

/**
 * –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –∏–≥—Ä—É.
 */
function restartGame() {
  energy = 100; // –°–±—Ä–æ—Å —ç–Ω–µ—Ä–≥–∏–∏
  found = { blue: 0, red: 0, yellow: 0, bomb: 0 }; // –°–±—Ä–æ—Å –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
  energyEl.textContent = energy;
  foundEl.textContent = `üîµ0/2 üî¥0/2 üü°0/1 üí£0/5`;
  resultEl.textContent = ''; // –û—á–∏—Å—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ
  restartBtn.style.display = 'none'; // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞"
  gameOutcome = ''; // –°–±—Ä–æ—Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∏–≥—Ä—ã

  // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤–æ–µ –ø–æ–ª–µ –∏ —Ä–µ–Ω–¥–µ—Ä–∏–º –µ–≥–æ, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞
  if (generateGrid()) {
    renderGrid();
  } else {
    grid.innerHTML = ''; // –û—á–∏—â–∞–µ–º —Å–µ—Ç–∫—É, –µ—Å–ª–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å
  }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
// –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–æ–ª–µ –∏ —Ä–µ–Ω–¥–µ—Ä–∏–º –µ–≥–æ, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞
const generationSuccess = generateGrid();
if (generationSuccess) {
  renderGrid();
} else {
  grid.innerHTML = ''; // –û—á–∏—â–∞–µ–º —Å–µ—Ç–∫—É, –µ—Å–ª–∏ –Ω–∞—á–∞–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å
}
</script>
</body>
</html>
